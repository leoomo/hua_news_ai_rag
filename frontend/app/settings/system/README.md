# 系统设置页面

## 功能概述

系统设置页面提供了对华新AI知识库系统的全局配置管理功能，主要包括邮件配置管理。

## 主要功能

### 1. 邮件配置管理

#### 功能开关
- **启用邮件模块**: 总开关，控制整个邮件功能是否可用
- **启用邮件通知**: 细粒度开关，控制是否发送通知邮件

#### 收件人配置
- 支持添加多个收件人邮箱
- 实时验证邮箱格式
- 可以删除已添加的收件人
- 支持回车键快速添加

#### 邮件内容配置
- **发件人显示名称**: 自定义发件人在邮件中显示的名称
- **邮件服务商**: 选择预配置的邮件服务商（163、QQ、Gmail、Outlook、Yahoo、新浪、自定义SMTP）
- **发件邮箱**: 配置用于发送邮件的邮箱地址
- **邮箱密码/授权码**: 配置邮箱的密码或授权码（注意：授权码不是登录密码）
- **邮件格式**: 支持HTML和Markdown两种格式
- **模板语言**: 支持中文和英文两种语言
- **每封邮件最多文章数**: 控制单封邮件包含的文章数量（1-50）

#### 自定义SMTP配置（当选择"自定义SMTP"时显示）
- **SMTP服务器地址**: 自定义SMTP服务器地址
- **SMTP端口**: SMTP服务器端口号
- **使用TLS**: 是否启用TLS加密
- **使用SSL**: 是否启用SSL加密

#### 发送配置
- **发送超时**: 邮件发送超时时间（10-120秒）
- **重试次数**: 发送失败时的重试次数（0-10次）
- **重试延迟**: 重试之间的延迟时间（1-60秒）

## 技术特性

### 前端特性
- 响应式设计，支持移动端和桌面端
- 实时表单验证
- 优雅的错误和成功提示
- 禁用状态管理（当邮件模块关闭时，相关配置项会被禁用）

### 后端特性
- 配置文件实时更新
- 数据验证和类型检查
- 安全的文件操作
- 配置热重载

## 配置存储

所有配置都保存在 `backend/email_fly/email_config.py` 文件中，修改后会立即生效。

## 使用说明

1. **启用邮件功能**: 首先勾选"启用邮件模块"
2. **选择邮件服务商**: 根据您的邮箱选择对应的服务商
3. **配置发件邮箱**: 输入用于发送邮件的邮箱地址和密码/授权码
4. **自定义SMTP配置**: 如果选择"自定义SMTP"，需要配置SMTP服务器信息
5. **配置收件人**: 添加需要接收通知的邮箱地址
6. **设置邮件内容**: 根据需要调整发件人名称、格式和语言
7. **优化发送参数**: 根据网络环境调整超时和重试参数
8. **保存配置**: 点击"保存配置"按钮应用更改

## 邮件服务商说明

- **163邮箱**: 使用SMTP 465端口，SSL加密
- **QQ邮箱**: 使用SMTP 587端口，TLS加密，需要授权码
- **Gmail**: 使用SMTP 587端口，TLS加密，需要应用专用密码
- **Outlook**: 使用SMTP 587端口，TLS加密
- **Yahoo**: 使用SMTP 587端口，TLS加密，需要应用专用密码
- **新浪邮箱**: 使用SMTP 25端口，无加密
- **自定义SMTP**: 可配置任意SMTP服务器，支持TLS/SSL选项

## 注意事项

- 修改配置后需要重启后端服务才能完全生效
- 邮箱地址必须是有效的格式
- **重要**: 邮箱密码/授权码不是登录密码，需要在邮箱设置中获取
- **QQ邮箱**: 需要在邮箱设置中开启SMTP服务并获取授权码
- **Gmail**: 需要开启两步验证并生成应用专用密码
- **163邮箱**: 需要在邮箱设置中开启SMTP服务并获取授权码
- 建议在测试环境中先验证邮件功能
- 如果遇到邮件发送问题，可以临时禁用邮件模块
- 自定义SMTP配置时，确保服务器地址和端口正确

## 邮件模板

系统内置了中文和英文两种语言的邮件模板，支持HTML和Markdown格式：

- **中文模板**: 适合中文用户使用
- **英文模板**: 适合国际化场景
- **HTML格式**: 样式丰富，兼容性好
- **Markdown格式**: 易于编辑和维护

## 故障排除

### 常见问题

1. **配置保存失败**
   - 检查文件权限
   - 确认配置文件路径正确

2. **邮件发送失败**
   - 检查SMTP配置
   - 确认网络连接
   - 查看后端日志

3. **配置不生效**
   - 重启后端服务
   - 检查配置文件语法

### 日志查看

邮件相关的日志信息会在后端控制台显示，包括：
- 配置加载状态
- 邮件发送结果
- 错误信息详情
